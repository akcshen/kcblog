(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{335:function(t,s,a){"use strict";a.r(s);var n=a(11),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"使用-popstate-监听用户的返回行为"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-popstate-监听用户的返回行为"}},[t._v("#")]),t._v(" 使用 popstate 监听用户的返回行为")]),t._v(" "),s("h3",{attrs:{id:"正常的操作代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#正常的操作代码"}},[t._v("#")]),t._v(" 正常的操作代码")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(' function pushHistory() {\n    var state = {\n        title: "title",\n        url: "#"\n    };\n    window.history.pushState(state, "title", "#");\n}\n\nwindow.addEventListener("popstate", function (e) {\n    // alert("我监听到了浏览器的返回按钮事件啦");//根据自己的需求实现自己的功能\n    window.location.href = "https://sogou.com"\n    // window.location.reload()\n    // window.location.href = \'https://www.zixunkankan.xyz/static/web/site/guessong.html?hid=101&pageid=1\'\n    //  window.history.go(-1);\n}, false);\n\npushHistory();\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br")])]),s("h3",{attrs:{id:"异常不生效"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#异常不生效"}},[t._v("#")]),t._v(" 异常不生效")]),t._v(" "),s("p",[t._v("但是你会发现在有的浏览器上并不生效\n这里主要记录一下不生效的可能原因：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("W3C规范指出，当traversing history(请参阅第14条)时，允许UA(浏览器)在popstate中排队。 popstate是异步触发的(即使此时URL已更改)。浏览器供应商以不同的方式解释和实现此规范。 Mozilla decides Firefox应该能够在popstate之前触发load，并且出于充分的理由，这样慢速图像就不会阻止popstate。\nChrome/Safari做出其他决定，这导致了我们的问题:\n在管理Web应用程序的历史记录时，通常希望尽快启动历史记录管理，例如。在DOMContentLoaded而不是load。 但作为返回，用户无法退出任何pushState，因为所有popstate都排队等待直到load为止。")]),t._v(" "),s("p",[t._v("我们正在寻求有关处理此类情况的建议。我自己想出几个:")]),t._v(" "),s("ul",[s("li",[t._v("延迟加载图片，因此load可以尽快触发。")]),t._v(" "),s("li",[t._v("阻止用户界面，直到触发load。")]),t._v(" "),s("li",[t._v("在load而不是DOMContentLoaded上的Init框架。")])]),t._v(" "),s("p",[t._v("有更好的解决方案吗？")]),t._v(" "),s("p",[t._v("更新:当ajat在load之前触发时，事情变得很难看，如果那些请求导致DOM更改，并且DOM更改碰巧有一些图像，则load会延迟到这些图像加载/超时，这意味着popstate会排队等待更长。")]),t._v(" "),s("p",[t._v("更新2 :要为其添加一个简单的演示，请访问此带有chrome的jsbin page，并查看popstate将被阻止，直到触发load为止。您可以比较缓存的图像和未缓存的图像的结果。")]),t._v(" "),s("p",[t._v("最佳答案")]),t._v(" "),s("p",[t._v("您可以在上一页卸载期间尝试调用popstate吗？例如，如果您在第1页中并且想移至第2页，而不是在第2页的加载/就绪期间调用弹出状态，那么为什么不在第1页的unload事件中调用弹出状态呢？")]),t._v(" "),s("p",[t._v("不确定是否满足您的情况。但我无法在您的垃圾箱中尝试。")]),t._v(" "),s("p",[t._v("关于javascript - 当浏览器不立即触发popstate事件时，如何处理后退按钮，我们在Stack Overflow上找到一个类似的问题：\nhttps://stackoverflow.com/questions/24096717/")])]),t._v(" "),s("li",[s("p",[t._v("部分手机机型的onpopstate首次进入页面无任何交互式没办法触发的，有了交互他就可以触发。面对这样的问题可以加一个事件主动去触发 或者 一进入加个弹窗进行交互下就可以让onpopstate生效。\n"),s("code",[t._v("针对部分浏览器生效，假如是做微博等其他业务内嵌浏览器的话可能不生效")])])])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("<span class=\"virtualEle\" @click=\"virtualClick\" ref=\"virtualEle\" v-if=\"virtualEleShow\">xxx</span>\n window.addEventListener('popstate', vm.onPopstate)\n   vm.$refs.virtualEle.click()\n   if (window.history.state !== 'virtualEleInfo') {\n     const state = 'virtualEleInfo'\n     window.history.pushState(state, 'title', '#')\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);