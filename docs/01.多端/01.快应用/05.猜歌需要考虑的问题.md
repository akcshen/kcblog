---
title: 猜歌需要考虑的问题
date: 2023-03-14 19:22:58
permalink: /pages/35b084/
categories:
  - 多端
  - 快应用
tags:
  -
---

1. 华为广告组件销毁，必须写在广告组件上面
2. （广告组件封装）广告支持传入自定义样式
3. 全部广告封装为一个组件
4. 登录问题（无论进入任何页面都能获取到用户信息）
   ::: theorem 小程序登录问题
   在 app.js 里面写登录，需要考虑各个页面不一致的问题
   解决方案一： 在 onShow 函数中判断全局数据中的 sessionKey 是否已经准备好，如果没有准备好则等待登录成功之后再进行页面的数据初始化等操作。示例代码如下：

   ```js
   // page.js
   Page({
     data: {
       isLoginReady: false, // 用户登录状态是否准备好
     },
     onShow: function () {
       // 获取全局数据中的sessionKey，如果没有则等待登录
       const sessionKey = getApp().globalData.sessionKey;
       if (sessionKey) {
         // 用户已经登录，可以开始页面的数据初始化等操作
         this.setData({ isLoginReady: true });
         // TODO: 页面数据初始化等操作
       } else {
         // 用户尚未登录，等待登录成功之后再进行操作
         getApp().loginReadyCallback = () => {
           this.setData({ isLoginReady: true });
           // TODO: 页面数据初始化等操作
         };
       }
     },
   });
   ```

   然后在 app.js 里面定义

   ```js
   // app.js
   App({
   globalData: {
    sessionKey: null,
    loginReadyCallback: null, // 登录成功后的回调函数
   },
   onLaunch: function() {
    // 登录
    wx.login({
      success: res => {
        // 调用登录API获取sessionKey
        wx.request({
          url: 'https://example.com/login',
          data: { code: res.code },
          success: res => {
            //  loginReadyCallback 回调函数，则在登录成功后执行回调函数
            }
        })
      }
    })
   ```

   :::

-
